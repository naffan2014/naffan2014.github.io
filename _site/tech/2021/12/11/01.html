<!DOCTYPE html>
<html lang="en">
  <head>
    
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Async和Transactional注解使用时的动态代理问题 | 拿饭网</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Async和Transactional注解使用时的动态代理问题" />
<meta name="author" content="张一帆" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="代理是指由被委托人接受委托人的委托全权去办理一件事情，在办理这件事情的过程中委托人会限制被委托人的行事边界。" />
<meta property="og:description" content="代理是指由被委托人接受委托人的委托全权去办理一件事情，在办理这件事情的过程中委托人会限制被委托人的行事边界。" />
<link rel="canonical" href="https://naffan.cn/tech/2021/12/11/01.html" />
<meta property="og:url" content="https://naffan.cn/tech/2021/12/11/01.html" />
<meta property="og:site_name" content="拿饭网" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-12-11T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Async和Transactional注解使用时的动态代理问题" />
<meta name="twitter:site" content="@naffan2011" />
<meta name="twitter:creator" content="@张一帆" />
<meta property="fb:admins" content="张一帆" />
<meta property="article:publisher" content="张一帆" />
<meta property="fb:app_id" content="100002835701051" />
<script type="application/ld+json">
{"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://naffan.cn/tech/2021/12/11/01.html"},"headline":"Async和Transactional注解使用时的动态代理问题","dateModified":"2021-12-11T00:00:00+08:00","datePublished":"2021-12-11T00:00:00+08:00","author":{"@type":"Person","name":"张一帆"},"url":"https://naffan.cn/tech/2021/12/11/01.html","description":"代理是指由被委托人接受委托人的委托全权去办理一件事情，在办理这件事情的过程中委托人会限制被委托人的行事边界。","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="shortcut icon" href="https://www.naffan.cn/favicon.ico">
<link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.css" rel="stylesheet">
<link href="/css/bootstrap.min.css" rel="stylesheet">
<link href="/css/hc.css" rel="stylesheet">
<link href="/css/highlight/github-gist.css" rel="stylesheet">
<!--baidu站长统计-->
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?c875589e505f2bef54c6b37e8a527e39";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
<!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif] d-->
    <!-- Bootstrap core JavaScript-->
<script src="/js/jquery-3.4.1.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/hc.js"></script>
<script src="/js/jquery.lazyload.js"></script>
<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
  </head>
  <body>
    <div class="nav-toggle"><i class="fa fa-bars fa-2x"></i> naffan</div>
    <div id = "wrapper">
      <div class="navbar navbar-default" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <p class="navbar-brand">拿饭网</p>
    </div>
    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
      <!-- <li><a href="/list/index.html">文章列表</a></li> -->
      <li><a href="/tech/index.html">技术总结</a></li>
      <li><a href="/life/index.html">生活闲杂</a></li>
      <li><a href="/thinking/index.html">沈思默想</a></li>
      <li><a href="/economy/index.html">经济杂谈</a></li>
      <li><a href="/drama/index.html">拍摄剧本</a></li>
      <li><a href="/books/index.html">阅读书籍</a></li>
      <li><a href="/links/index.html">精彩链接</a></li>
      <li><a href="/about/index.html">关于本人</a></li> 
      </ul>
    </div><!--/.nav-collapse -->
  </div>
</div>

<!-- Sidebar -->
<div id="sidebar-wrapper">
  <ul class="sidebar-nav">
    <li class="sidebar-brand"><a href="/"><h1 class="brand">拿饭网</h1></a><h3>一个属于自己的博客网站</h3></li>
    <iframe width="100%" height="70" class="share_self"  frameborder="0" scrolling="no" src="https://widget.weibo.com/weiboshow/index.php?language=&width=0&height=100&fansRow=2&ptype=1&speed=0&skin=7&isTitle=0&noborder=0&isWeibo=0&isFans=0&uid=1941183154&verifier=1df81c39&colors=f7f7f7,f7f7f7,666666,0082cb,ecfbfd&dpc=1"></iframe>
    <hr />
    <!-- <li><a href="/list/index.html">文章列表</a></li> -->
    <li><a href="/tech/index.html">技术总结</a></li>
    <li><a href="/life/index.html">生活闲杂</a></li>
    <li><a href="/thinking/index.html">沈思默想</a></li>
    <li><a href="/economy/index.html">经济杂谈</a></li>
    <li><a href="/drama/index.html">拍摄剧本</a></li>
    <li><a href="/books/index.html">阅读书籍</a></li>
    <li><a href="/links/index.html">精彩链接</a></li>
    <li><a href="/about/index.html">关于本人</a></li> 
    <hr>
  </ul>
</div>

      <div class="container">
        <link rel="stylesheet" href="/css/toc.css" type="text/css" media="screen">
<link rel="stylesheet" href="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.css" type="text/css">
<script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>
<script src="/js/jquery.toc.js"></script>
<script type="text/javascript" charset="utf-8">
  $(function() {
      $("img.lazy").lazyload({effect: "fadeIn"});
  });
</script>
 <script type="text/javascript">
    $(function() {
      $('#toc').toc({
        showAlways:true,
        renderIn:'#renderIn',
        contentsText:"Legenda",
        hideText:'Collapse',
        showText:'Expand',
        showCollapsed:true
      });
    });
    </script>
<div id="article">
	<div class="article-title">Async和Transactional注解使用时的动态代理问题</div>
	<p class="meta">
		<small>&nbsp;<i class="fa fa-user-circle" aria-hidden="true"></i>
			  
			 	张一帆
			 
		 </small>
		<small>&nbsp;<i class="fa fa-calendar-o" aria-hidden="true"></i> 2021年12月11日</small>
	</p> 
	<hr/>
	<div  class="post">
		<div id="toc-container">
  <table class="toc" id="toc">
    <tbody>
      <tr>
        <td>
          <div id="toctitle">
            <h2>目录</h2>
          </div>
          <ul>
            <li class="toc_level-1 toc_section-1">
              <a href="#tocAnchor-1-1"><span class="tocnumber">1</span> <span class="toctext">@Transactional</span></a>
            </li>
            <li class="toc_level-1 toc_section-2">
              <a href="#tocAnchor-1-2"><span class="tocnumber">2</span> <span class="toctext">@Async 和 @Transactional</span></a>
            </li>
          </ul>
        </td>
      </tr>
    </tbody>
  </table>
</div><blockquote>
  <p>代理是指由被委托人接受委托人的委托全权去办理一件事情，在办理这件事情的过程中委托人会限制被委托人的行事边界。</p>
</blockquote>

<p>哈喽 大家好，这次我想写一些关于我在工作中遇到的有关java动态代理问题的排查与解决，希望能够帮助自己总结的同时对网络上的其他小伙伴有些许的帮助。首先我要列举几个@Async和@Transactional的例子。</p>

<h1 id="tocAnchor-1-1">@Transactional</h1>

<p>这种情况属于“自调用”的情况。自调用的意思就是通过CGLIB方式动态代理的方法，调用了类内其他方法。这种“自调用”的情况会使注解无效。具体代码如下：</p>

<pre>
  <code class="language-java">@Service
public class Galaxy {

    @Autowired
    private UserRepository userRepository;

    public void alpha(){
        beta();//这就是“自调用”：在Galaxy类内注解的方法内调用了同类内的其他方法。
    }

    //对beta()方法开启了事务
    @Transactional
    public void beta(){
        UserDomain UserDomain = new UserDomain();
        UserDomain.setId(4L);
        UserDomain.setName("周杰伦");
        UserDomain.setAccount("Jay zhou");
        UserDomain.setPwd("123456");
        userRepository.save(UserDomain);
        UserDomain = new UserDomain(); //断点
        UserDomain.setId(3L);
        UserDomain.setName("周华健");
        UserDomain.setAccount("zhouhuajina");
        UserDomain.setPwd("123456");
        userRepository.save(UserDomain);
    }
}
</code>
</pre>

<p>　　在beta()方法中打下断点，数据库中是没有事务的。说明注解没有生效。</p>

<pre>
  <code class="language-shell">mysql&gt; select * from information_schema.innodb_trx \G;
Empty set (0.00 sec)
</code>
</pre>

<p>上面代码运行结果：</p>

<pre>
  <code class="language-shell">mysql&gt; select * from user;
+----+-------------+-----------+--------+
| id | account     | name      | pwd    |
+----+-------------+-----------+--------+
|  3 | zhouhuajina | 周华健    | 123456 |
|  4 | Jay zhou    | 周杰伦    | 123456 |
+----+-------------+-----------+--------+
</code>
</pre>

<p>　　通过断点时的堆栈信息，我们发现实际调用beta()的是<code> Galaxy$$EnhancerBySpringCGLIB$$76b76f24</code>方法。</p>

<pre>
  <code>beta:44, Galaxy (com.example.service.galaxy)
alpha:31, Galaxy (com.example.service.galaxy)
invoke:-1, Galaxy$$EnhancerBySpringCGLIB$$76b76f24 (com.example.service.galaxy)
......
</code>
</pre>

<p>　　Galaxy\(EnhancerBySpringCGLIB\)76b76f24方法是通过cglib做动态代理时被jvm建立起来的一个虚拟的文件，这个文件是对Galxy类的增强类(GalxyEnhence)，增强类继承了Galaxy类并对注解的类进行方法增强。方法增强指的是你使用的那个注解会把相关代码（注解开发人员早已经写好了的代码）用重写的方式将你的代码增强起来。所以，这个被jvm虚拟出来的文件大概应该长这样：</p>

<pre>
  <code class="language-java">public class Galaxy$$EnhancerBySpringCGLIB$$76b76f24 extend Galaxy{
  
  		//因为beta方法被注解了，所以通过重写的方式增强这个方法。其他没有被注解的方法，不重写
     @Override
     public void beta(){
      try {
            // 开启事务
            startTransaction();
            UserDomain UserDomain = new UserDomain();
            UserDomain.setId(4L);
            UserDomain.setName("周杰伦");
            UserDomain.setAccount("Jay zhou");
            UserDomain.setPwd("123456");
            userRepository.save(UserDomain);
            UserDomain = new UserDomain();
            UserDomain.setId(3L);
            UserDomain.setName("周华健");
            UserDomain.setAccount("zhouhuajina");
            UserDomain.setPwd("123456");
            userRepository.save(UserDomain);
        } catch (Exception e) {
            // 出现异常回滚事务
            rollbackTransaction();
        }
        // 提交事务
        commitTransaction();
    }
    
}
</code>
</pre>

<p>但是，这段代码出现了一个问题：<code>beta()的调用者是隐含的this</code>。这就是“自调用”的意思，那实际的调用链是：Galaxy.alpha() =&gt;  Galaxy.beta()。它没有走我们的增强类的beta()！所以就出现了刚才的结果。按照这种思路可以这样改：</p>

<h3 id="解决方案1利用transactional的传递性在总方法上加transactional">解决方案1：利用@Transactional的传递性，在总方法上加@Transactional。</h3>

<pre>
  <code class="language-java">@Service
public class Galaxy {

    @Autowired
    private UserRepository userRepository;

    //解决方案1：将注解加到alpha上。
    //借助@transactional的传递性，会把beta()也加到事务里来。
  	@Transactional
    public void alpha(){
        beta();
    }
  
    public void beta(){
        UserDomain UserDomain = new UserDomain();
        UserDomain.setId(4L);
        UserDomain.setName("周杰伦");
        UserDomain.setAccount("Jay zhou");
        UserDomain.setPwd("123456");
        userRepository.save(UserDomain);
        UserDomain = new UserDomain(); //断点
        UserDomain.setId(3L);
        UserDomain.setName("周华健");
        UserDomain.setAccount("zhouhuajina");
        UserDomain.setPwd("123456");
        userRepository.save(UserDomain);
    }
}
</code>
</pre>

<p>　　在beta()方法中打下断点，数据库中出现了事务，说明起效了。</p>

<pre>
  <code class="language-shell">mysql&gt; select * from information_schema.innodb_trx \G;
*************************** 1. row ***************************
                    trx_id: 422025326292896
                 trx_state: RUNNING
               trx_started: 2021-12-12 21:54:14
     trx_requested_lock_id: NULL
          trx_wait_started: NULL
                trx_weight: 0
       trx_mysql_thread_id: 6022
                 trx_query: NULL
       trx_operation_state: NULL
         trx_tables_in_use: 0
         trx_tables_locked: 0
          trx_lock_structs: 0
     trx_lock_memory_bytes: 1128
           trx_rows_locked: 0
         trx_rows_modified: 0
   trx_concurrency_tickets: 0
       trx_isolation_level: REPEATABLE READ
         trx_unique_checks: 1
    trx_foreign_key_checks: 1
trx_last_foreign_key_error: NULL
 trx_adaptive_hash_latched: 0
 trx_adaptive_hash_timeout: 0
          trx_is_read_only: 0
trx_autocommit_non_locking: 0
       trx_schedule_weight: NULL
1 row in set (0.00 sec)
</code>
</pre>

<p>调用链为：Galaxy\(EnhancerBySpringCGLIB\)76b76f24.alpha()=&gt; Galaxy\(EnhancerBySpringCGLIB\)76b76f24.beta()</p>

<h3 id="解决方案2在被代理类的外部调用其方法">解决方案2：在被代理类的外部调用其方法。</h3>

<pre>
  <code class="language-java">// Galaxy.java
@Service
public class Galaxy {

    @Autowired
    private UserService userService;

    public void alpha(){
        userService.beta();//调用者换成了外部类userService。
    }
}

//UserService.java
@Service
public class UserService {
    @Autowired
    private UserRepository userRepository;

    //将注解放到这里。
    @Transactional
    public void beta(){
        UserDomain UserDomain = new UserDomain();
        UserDomain.setId(4L);
        UserDomain.setName("周杰伦");
        UserDomain.setAccount("Jay zhou");
        UserDomain.setPwd("123456");
        userRepository.save(UserDomain);
        UserDomain = new UserDomain();  //断点
        UserDomain.setId(3L);
        UserDomain.setName("周华健");
        UserDomain.setAccount("zhouhuajina");
        UserDomain.setPwd("123456");
        userRepository.save(UserDomain);
    }
}
</code>
</pre>

<p>调用链为：Galaxy.alpha =&gt; UserService.beta()。这其实不能算是一种解决方案，而是一种解决思路。</p>

<h3 id="解决方案3自注入">解决方案3：自注入</h3>

<pre>
  <code class="language-java">@Service
public class Galaxy {

  	//注解自己进入spring容器里。
  	@Autowired
  	private Galaxy galaxy
      
    @Autowired
    private UserRepository userRepository;
  	
    public void alpha(){
        galaxy.beta();  //beta()的调用者换成了galaxy类，就可以让spring直接从容器里拿增强类。
    }
  
    @Transactional
    public void beta(){
        UserDomain UserDomain = new UserDomain();
        UserDomain.setId(4L);
        UserDomain.setName("周杰伦");
        UserDomain.setAccount("Jay zhou");
        UserDomain.setPwd("123456");
        userRepository.save(UserDomain);
        UserDomain = new UserDomain(); //断点
        UserDomain.setId(3L);
        UserDomain.setName("周华健");
        UserDomain.setAccount("zhouhuajina");
        UserDomain.setPwd("123456");
        userRepository.save(UserDomain);
    }
}
</code>
</pre>

<p>　　调用链为：Galaxy.alpha()=&gt;Galaxy\(EnhancerBySpringCGLIB\)76b76f24.beta()</p>

<h1 id="tocAnchor-1-2">@Async 和 @Transactional</h1>

<p>看下面的列子：</p>

<pre>
  <code class="language-java">@Service
public class Galaxy {

    @Autowired
    private UserRepository userRepository;

    @Transactional(rollbackFor = Exception.class)
    public void alpha() throws Exception{
        UserDomain UserDomain = new UserDomain();
        UserDomain.setId(4L);
        UserDomain.setName("周杰伦");
        UserDomain.setAccount("Jay zhou");
        UserDomain.setPwd("123456");
        userRepository.save(UserDomain);
        UserDomain = new UserDomain();
        UserDomain.setId(3L);
        UserDomain.setName("周华健");
        UserDomain.setAccount("zhouhuajina");
        UserDomain.setPwd("123456");
        userRepository.save(UserDomain);
        beta();
    }

    @Async(value = "beta")
    public void beta() throws InterruptedException {
        Thread.sleep(3000);
        System.out.println("这是beta线程"); //断点
    }

}
</code>
</pre>

<p>　　这个例子的意图是：alpha方法首先入库数据，然后调用异步方法beta。预期的效果应该是，alpha()直接插入数据，立刻退出。不会等到beta()中的数据输出。但是，实际情况却是alpha()在等待beta()3秒后，输出beta线程文案后退出。这意味着beta()上的@Async没有起效。</p>

<p>我在beta()中打了个断点，让我们看看当时的堆栈是什么情况：</p>

<pre>
  <code class="language-shell">beta:47, Galaxy (com.example.service.galaxy)
alpha:41, Galaxy (com.example.service.galaxy)
。。。。。
alpha:-1, Galaxy$$EnhancerBySpringCGLIB$$d543df13 (com.example.service.galaxy)
。。。。。
</code>
</pre>

<p>按照刚才的理论来讲，应该是jvm制造出来了一个增强类叫<code> Galaxy$$EnhancerBySpringCGLIB$$d543df13</code>，这个类继承了Galaxy类并且重写了alpha()和beta()。调用链应该是： Galaxy\(EnhancerBySpringCGLIB\)d543df13.alpha() =&gt; Galaxy.beta()。因为调用的是Galaxy.beta()而不是 Galaxy\(EnhancerBySpringCGLIB\)d543df13.beta()，所以@Async没有生效。</p>

<p>　　但是，按照上面解决方案2来重新构造代码发现@Async仍然没有生效，这就有些矛盾了。通过搜索找到了这篇<a href="https://github.com/spring-projects/spring-framework/issues/11806">issue</a>。根据文中所述，是@Async和@Transactional的order先后的顺序导致了这个问题。因为spring开发者认为@Async的顺序应该是最优先的，所以即使@Async和@Transactional放在了一起，也会是先实现异步再进行事务。那接下来让我们试一试：</p>

<pre>
  <code class="language-java">//Galaxy.java
@Service
public class Galaxy {

    @Autowired
    private UserRepository userRepository;

    @Autowired
    private UserService userService;

  //1.先异步线程
    @Async(value = "alpha")
    public void alpha() throws Exception{
        System.out.println("alpha thread start");
        userService.beta(); //2.进入事务中
        System.out.println("alpha thread end");
        userService.gamma(); //3.抛出异常，回滚
    }
}


//UserService.java
@Service
public class UserService {
    @Autowired
    private UserRepository userRepository;

    @Transactional(rollbackFor = Exception.class)
    public void beta() throws Exception{
        System.out.println("这是beta线程");
        UserDomain UserDomain = new UserDomain();
        UserDomain.setId(4L);
        UserDomain.setName("周杰伦");
        UserDomain.setAccount("Jay zhou");
        UserDomain.setPwd("123456");
        userRepository.save(UserDomain);
        UserDomain = new UserDomain();
        UserDomain.setId(3L);
        UserDomain.setName("周华健");
        UserDomain.setAccount("zhouhuajina");
        UserDomain.setPwd("123456");
        userRepository.save(UserDomain);
    }

    public void gamma() throws Exception {
        throw new Exception();
    }

}
</code>
</pre>

<p>　　最终结果，符合预期，数据库里的数据被回滚了。然后再试一次两个注解在一起的情况：</p>

<pre>
  <code class="language-java">//Galaxy.java
@Service
public class Galaxy {

    @Autowired
    private UserRepository userRepository;

    @Autowired
    private UserService userService;

  //1.先异步线程
    @Async(value = "alpha")
    @Transactional(rollbackFor = Exception.class)
    public void alpha() throws Exception{
        System.out.println("alpha thread start");
        userService.beta(); //2.进入事务中
        System.out.println("alpha thread end");
        userService.gamma(); //3.抛出异常，回滚
    }
}


//UserService.java
@Service
public class UserService {
    @Autowired
    private UserRepository userRepository;

    public void beta() throws Exception{
        System.out.println("这是beta线程");
        UserDomain UserDomain = new UserDomain();
        UserDomain.setId(4L);
        UserDomain.setName("周杰伦");
        UserDomain.setAccount("Jay zhou");
        UserDomain.setPwd("123456");
        userRepository.save(UserDomain);
        UserDomain = new UserDomain();
        UserDomain.setId(3L);
        UserDomain.setName("周华健");
        UserDomain.setAccount("zhouhuajina");
        UserDomain.setPwd("123456");
        userRepository.save(UserDomain);
    }

    public void gamma() throws Exception {
        throw new Exception();
    }

}
</code>
</pre>

<p>　　最终，也符合预期。最后，至于注解的时序原理等我有时间研究一下再写出来。</p>


		<!--分享按钮 开始-->
		<div class="bdsharebuttonbox" style="margin-left:auto;margin-right:2px;width:140px;">
			<a href="#" class="bds_more" data-cmd="more"></a>
			<a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a>
			<a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
			<a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>
		</div>
		<script>
			window._bd_share_config={
				"common":{
					"bdSnsKey":{},
					"bdText":"",
					"bdMini":"2",
					"bdPic":"",
					"bdStyle":"0",
					"bdSize":"16"
				},
				"share":{},
				"image":{
					"viewList":["qzone","tsina","tqq","renren","weixin"],
					"viewText":"分享到：","viewSize":"16"
				},
				"selectShare":{
					"bdContainerClass":null,
					"bdSelectMiniList":["qzone","tsina","tqq","renren","weixin"]
				}};
				with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
		</script>
		<!--分享按钮 结束-->
		<hr>
		<div>
			<ul class="pager">

 	<li class="previous"><a href="/tech/2021/11/25/01.html">&larr; 前一篇</a></li>



	<li class="next"><a href="/drama/2022/02/18/1.html">后一篇 &rarr;</a></li>

</ul>

		</div>
	</div>
	<!--PC和WAP自适应版-->
<div id="SOHUCS" sid="/tech/2021/12/11/01.html"></div> 
<script type="text/javascript"> 
(function(){ 
var appid = 'cysGfqald'; 
var conf = 'prod_bd33a87b5e12ce2566d15909589be5f9'; 
var width = window.innerWidth || document.documentElement.clientWidth; 
if (width < 1000) {
var head = document.getElementsByTagName('head')[0]||document.head||document.documentElement;
var script = document.createElement('script');
script.type = 'text/javascript';
script.charset = 'utf-8';
script.id = 'changyan_mobile_js';
script.src = 'https://cy-cdn.kuaizhan.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf;
head.appendChild(script);
} else { var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://cy-cdn.kuaizhan.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})}); } })(); </script>
</div>


      </div>
      <div class="container">
  <footer>
	  <script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-93033182-1', 'auto');
	  ga('send', 'pageview');

	</script>
    <p>
      &copy; 2022 拿饭网 &middot;
      <script src="https://s13.cnzz.com/z_stat.php?id=1272020504&web_id=1272020504" language="JavaScript"></script> &middot;
      <a href="https://beian.miit.gov.cn">京ICP备16029491号-4</a>
    </p>
  </footer>
</div>

    </div>
  </body>
</html>
